name: Deploy to Hugging Face Space
on:
  # Trigger autom√°tico cuando se hace push a la rama main
  push:
    branches: [ main ]
  # Permite ejecutar manualmente desde la pesta√±a Actions
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # Paso 1: Descargar el c√≥digo del repositorio
      - name: Checkout c√≥digo
        uses: actions/checkout@v3
        with:
          # Depth 0 para obtener todo el historial (necesario para --force)
          fetch-depth: 0
          # Habilitar Git LFS si se usan archivos grandes
          lfs: true

      # Paso 2: Configurar Git con usuario y email
      - name: Configurar Git
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

      # Paso 3: Sincronizar con Hugging Face Space
      - name: Push a Hugging Face Space
        env:
          # Usar el token secreto almacenado en GitHub
          TOKEN: ${{ secrets.HF_TOKEN3 }}
          # Datos del Space
          HF_USERNAME: goovylive
          SPACE_NAME: grafica-implicita
        run: |
          echo "üîß Configurando remote de Hugging Face..."
          echo "Token length: ${#TOKEN}"  # Para verificar que el token no est√© vac√≠o
          
          # M√©todo 1: Configurar git con el token como header de autenticaci√≥n
          git config --global http.https://huggingface.co/.extraheader "Authorization: Bearer ${TOKEN}"
          
          # M√©todo 2: Agregar remote usando URL alternativa
          git remote add space https://huggingface.co/spaces/${HF_USERNAME}/${SPACE_NAME}
          
          echo "üöÄ Empujando c√≥digo a Hugging Face Space..."
          
          # Empujar usando el token configurado globalmente
          # Usamos --force para sobrescribir archivos iniciales del template
          git push --force space main
          
          # Limpiar configuraci√≥n
          git config --global --unset http.https://huggingface.co/.extraheader
          git remote remove space
          
          echo "‚úÖ Despliegue completado exitosamente en:"
          echo "https://huggingface.co/spaces/${HF_USERNAME}/${SPACE_NAME}"
