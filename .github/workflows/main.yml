name: Deploy to Hugging Face Space
on:
  # Trigger autom√°tico cuando se hace push a la rama main
  push:
    branches: [ main ]
  # Permite ejecutar manualmente desde la pesta√±a Actions
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # Paso 1: Descargar el c√≥digo del repositorio
      - name: Checkout c√≥digo
        uses: actions/checkout@v3
        with:
          # Depth 0 para obtener todo el historial (necesario para --force)
          fetch-depth: 0
          # Habilitar Git LFS si se usan archivos grandes
          lfs: true

      # Paso 2: Configurar Git con usuario y email
      - name: Configurar Git
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

      # Paso 3: Sincronizar con Hugging Face Space
      - name: Push a Hugging Face Space
        env:
          # Usar el token secreto almacenado en GitHub
          TOKEN: ${{ secrets.HF_TOKEN3 }}
          # Datos del Space
          HF_USERNAME: goovylive
          SPACE_NAME: grafica-implicita
        run: |
          # Usar formato CORRECTO con token de acceso (no password)
          # El formato correcto es: https://oauth2:${TOKEN}@huggingface.co
          echo "üîß Configurando remote de Hugging Face..."
          git remote add space https://oauth2:${TOKEN}@huggingface.co/spaces/${HF_USERNAME}/${SPACE_NAME}
          
          echo "üöÄ Empujando c√≥digo a Hugging Face Space..."
          # Empujar el c√≥digo con --force para sobrescribir cualquier conflicto
          # IMPORTANTE: --force es necesario porque Hugging Face Spaces inicia con archivos de plantilla
          git push --force space main
          
          echo "‚úÖ Despliegue completado exitosamente en:"
          echo "https://huggingface.co/spaces/${HF_USERNAME}/${SPACE_NAME}"
          
          # Limpiar el remote despu√©s del push
          git remote remove space
