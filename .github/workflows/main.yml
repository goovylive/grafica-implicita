name: Deploy to Hugging Face Space
on:
  # Trigger automático cuando se hace push a la rama main
  push:
    branches: [ main ]
  # Permite ejecutar manualmente desde la pestaña Actions
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # Paso 1: Descargar el código del repositorio
      - name: Checkout código
        uses: actions/checkout@v3
        with:
          # Depth 0 para obtener todo el historial (necesario para --force)
          fetch-depth: 0
          # Habilitar Git LFS si se usan archivos grandes
          lfs: true

      # Paso 2: Configurar Git con usuario y email
      - name: Configurar Git
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

      # Paso 3: Sincronizar con Hugging Face Space
      - name: Push a Hugging Face Space
        env:
          # Usar el token secreto almacenado en GitHub
          TOKEN: ${{ secrets.HF_TOKEN3 }}
          # Datos del Space - REEMPLAZA CON TUS DATOS
          HF_USERNAME: goovylive
          SPACE_NAME: grafica-implicita
        run: |
          # Agregar el remote de Hugging Face
          git remote add space https://${HF_USERNAME}:${TOKEN}@huggingface.co/spaces/${HF_USERNAME}/${SPACE_NAME}
          
          # Empujar el código con --force para sobrescribir cualquier conflicto
          # IMPORTANTE: --force es necesario porque Hugging Face Spaces inicia con archivos de plantilla
          git push --force space main
          
          echo "✅ Despliegue completado exitosamente en:"
          echo "https://huggingface.co/spaces/${HF_USERNAME}/${SPACE_NAME}"
